{% extends 'base.html.twig' %}

{% block title %}EcoNutri - Produits Bio{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <!-- Notre CSS personnalis√© pour la page d'accueil -->
    <link href="{{ asset('styles/home.css') }}" rel="stylesheet">
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Smooth scroll pour les ancres
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const target = document.querySelector(targetId);
                    if (target) {
                        const offsetTop = target.getBoundingClientRect().top + window.pageYOffset - 80;
                        window.scrollTo({
                            top: offsetTop,
                            behavior: 'smooth'
                        });
                    }
                });
            });

            // Gestion du formulaire diab√®te 
            const diabetesForm = document.getElementById('diabetes-form');
            if (diabetesForm) {
                // D√©terminer l'URL de l'API en fonction de l'environnement
                const getBackendUrl = () => {
                    const hostname = window.location.hostname;
                    if (hostname === 'localhost' || hostname === '127.0.0.1' || hostname.includes('127.0.0.1:8000')) {
                        return 'http://localhost:5000/predict';
                    } else {
                        return 'https://econutri-back-production.up.railway.app/predict';
                    }
                };
                
                diabetesForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    // Afficher un indicateur de chargement
                    const submitBtn = this.querySelector('button[type="submit"]');
                    const originalText = submitBtn.innerHTML;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyse en cours...';
                    submitBtn.disabled = true;

                    // R√©cup√©rer les donn√©es du formulaire
                    const formData = new FormData(this);
                    const data = {
                        Pregnancies: parseInt(formData.get('pregnancies')),
                        Glucose: parseFloat(formData.get('glucose')),
                        BloodPressure: parseFloat(formData.get('blood_pressure')),
                        SkinThickness: parseFloat(formData.get('skin_thickness')),
                        Insulin: parseFloat(formData.get('insulin')),
                        BMI: parseFloat(formData.get('bmi')),
                        DiabetesPedigreeFunction: parseFloat(formData.get('diabetes_pedigree')),
                        Age: parseInt(formData.get('age'))
                    };

                    try {
                        // Appeler l'API Flask (URL dynamique selon l'environnement)
                        const response = await fetch(getBackendUrl(), {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(data)
                        });

                        const result = await response.json();

                        // Afficher le r√©sultat avec recommandations
                        showPredictionResult(result.prediction, data);

                    } catch (error) {
                        console.error('Erreur:', error);
                        showPredictionResult('error', null, 'Erreur lors de l\'analyse. V√©rifiez que l\'API Flask est d√©marr√©e.');
                    } finally {
                        // R√©activer le bouton
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    }
                });
            }

            // Fonction pour afficher le r√©sultat avec recommandations
            function showPredictionResult(prediction, formData = null, customMessage = null) {
                // Cr√©er ou mettre √† jour l'affichage du r√©sultat
                let resultDiv = document.getElementById('prediction-result');
                
                if (!resultDiv) {
                    resultDiv = document.createElement('div');
                    resultDiv.id = 'prediction-result';
                    resultDiv.className = 'prediction-result';
                    diabetesForm.parentNode.insertBefore(resultDiv, diabetesForm.nextSibling);
                }

                let message, resultClass, recommendations, productsTitle;

                if (prediction === 'Diabetes' || prediction === 'Diab√®te') {
                    message = customMessage || 'üî¥ R√©sultat: Risque de Diab√®te d√©tect√©';
                    resultClass = 'prediction-diabetes';
                    recommendations = `
                        <div class="recommendations-section">
                            <h5><i class="fas fa-heartbeat"></i> Recommandations Sant√©</h5>
                            <ul>
                                <li>Consultez un m√©decin pour un diagnostic complet</li>
                                <li>Adoptez une alimentation √©quilibr√©e et pauvre en sucres</li>
                                <li>Pratiquez une activit√© physique r√©guli√®re</li>
                                <li>Surveillez votre poids et votre IMC</li>
                            </ul>
                        </div>
                        <div class="products-recommendations">
                            <h5><i class="fas fa-leaf"></i> Produits Recommand√©s</h5>
                            <p>Pour vous accompagner dans une alimentation saine :</p>
                            <div class="recommended-products-grid">
                                <div class="recommended-product">
                                    <i class="fas fa-seedling"></i>
                                    <span>L√©gumes verts frais</span>
                                </div>
                                <div class="recommended-product">
                                    <i class="fas fa-apple-alt"></i>
                                    <span>Fruits √† faible indice glyc√©mique</span>
                                </div>
                                <div class="recommended-product">
                                    <i class="fas fa-bread-slice"></i>
                                    <span>C√©r√©ales compl√®tes bio</span>
                                </div>
                                <div class="recommended-product">
                                    <i class="fas fa-fish"></i>
                                    <span>Prot√©ines maigres</span>
                                </div>
                            </div>
                            <a href="#recommandes" class="btn btn-recommendation">
                                <i class="fas fa-shopping-basket"></i>
                                D√©couvrir nos produits sant√©
                            </a>
                        </div>
                    `;
                    productsTitle = 'Produits Recommand√©s pour le Diab√®te';

                } else if (prediction === 'No Diabetes' || prediction === 'Pas de Diab√®te') {
                    message = customMessage || 'üü¢ R√©sultat: Aucun risque de diab√®te d√©tect√©';
                    resultClass = 'prediction-no-diabetes';
                    recommendations = `
                        <div class="recommendations-section">
                            <h5><i class="fas fa-check-circle"></i> Excellente nouvelle !</h5>
                            <ul>
                                <li>Continuez vos bonnes habitudes alimentaires</li>
                                <li>Maintenez une activit√© physique r√©guli√®re</li>
                                <li>Faites des bilans de sant√© annuels</li>
                                <li>Pr√©servez votre capital sant√©</li>
                            </ul>
                        </div>
                        <div class="products-recommendations">
                            <h5><i class="fas fa-leaf"></i> Pour Maintenir Votre Sant√©</h5>
                            <p>D√©couvrez nos produits pour une alimentation √©quilibr√©e :</p>
                            <div class="recommended-products-grid">
                                <div class="recommended-product">
                                    <i class="fas fa-carrot"></i>
                                    <span>L√©gumes de saison bio</span>
                                </div>
                                <div class="recommended-product">
                                    <i class="fas fa-apple-alt"></i>
                                    <span>Fruits frais locaux</span>
                                </div>
                                <div class="recommended-product">
                                    <i class="fas fa-seedling"></i>
                                    <span>Super-aliments</span>
                                </div>
                                <div class="recommended-product">
                                    <i class="fas fa-wheat-alt"></i>
                                    <span>C√©r√©ales anciennes</span>
                                </div>
                            </div>
                            <a href="#nouveautes" class="btn btn-recommendation">
                                <i class="fas fa-shopping-basket"></i>
                                Voir nos nouveaut√©s
                            </a>
                        </div>
                    `;
                    productsTitle = 'Produits pour Maintenir Votre Sant√©';

                } else {
                    message = customMessage || `‚ö†Ô∏è ${prediction}`;
                    resultClass = 'prediction-error';
                    recommendations = `
                        <div class="recommendations-section">
                            <h5><i class="fas fa-info-circle"></i> Conseil G√©n√©ral</h5>
                            <p>En attendant de pouvoir analyser vos r√©sultats, d√©couvrez nos produits bio pour une alimentation saine.</p>
                        </div>
                        <a href="#categories" class="btn btn-recommendation">
                            <i class="fas fa-store"></i>
                            Explorer nos cat√©gories
                        </a>
                    `;
                }

                resultDiv.innerHTML = `
                    <div class="prediction-alert ${resultClass}">
                        <div class="prediction-content">
                            <h4><i class="fas fa-stethoscope"></i> R√©sultat de l'analyse</h4>
                            <p class="prediction-message">${message}</p>
                            
                            ${recommendations}
                            
                            <p class="prediction-note">
                                <small>
                                    <i class="fas fa-info-circle"></i>
                                    Ce r√©sultat est indicatif et ne remplace pas une consultation m√©dicale.
                                </small>
                            </p>
                        </div>
                    </div>
                `;

                // Scroll vers le r√©sultat
                resultDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });

                // Mettre √† jour le titre des produits recommand√©s si n√©cessaire
                if (productsTitle) {
                    const productsTitleElement = document.querySelector('#recommandes .section-title');
                    if (productsTitleElement) {
                        const originalTitle = productsTitleElement.getAttribute('data-original-title') || 'Produits Recommand√©s';
                        productsTitleElement.setAttribute('data-original-title', originalTitle);
                        productsTitleElement.textContent = productsTitle;
                    }
                }
            }
        });
    </script>

    <style>
        /* Styles pour l'affichage des r√©sultats */
        .prediction-result {
            margin-top: 2rem;
            animation: fadeInUp 0.5s ease;
        }

        .prediction-alert {
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-left: 5px solid;
            margin-bottom: 2rem;
        }

        .prediction-diabetes {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            border-left-color: #c44569;
        }

        .prediction-no-diabetes {
            background: linear-gradient(135deg, #51cf66, #40c057);
            color: white;
            border-left-color: #2f9e44;
        }

        .prediction-error {
            background: linear-gradient(135deg, #ffd43b, #fcc419);
            color: #333;
            border-left-color: #e67700;
        }

        .prediction-content h4 {
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .prediction-message {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        /* Styles pour les recommandations */
        .recommendations-section {
            background: rgba(255,255,255,0.1);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            backdrop-filter: blur(10px);
        }

        .recommendations-section h5 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .recommendations-section ul {
            margin-bottom: 0;
            padding-left: 1.5rem;
        }

        .recommendations-section li {
            margin-bottom: 0.5rem;
        }

        .products-recommendations {
            background: rgba(255,255,255,0.15);
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
        }

        .products-recommendations h5 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .recommended-products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .recommended-product {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            transition: transform 0.3s ease;
        }

        .recommended-product:hover {
            transform: translateY(-2px);
        }

        .recommended-product i {
            font-size: 1.5rem;
            width: 30px;
            text-align: center;
        }

        .btn-recommendation {
            background: rgba(255,255,255,0.9);
            color: #2e7d32;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .btn-recommendation:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            color: #2e7d32;
        }

        .prediction-note {
            opacity: 0.9;
            margin-bottom: 0;
            margin-top: 1.5rem;
            font-style: italic;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Style pour le bouton d√©sactiv√© */
        button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .recommended-products-grid {
                grid-template-columns: 1fr;
            }
            
            .prediction-alert {
                padding: 1.5rem;
            }
        }
    </style>
{% endblock %}

{% block body %}
    <style>
        .product-image { width:100%; height:200px; overflow:hidden; border-radius:10px; margin-bottom:1rem; }
        .product-card-img { width:100%; height:100%; display:block; object-fit:cover; object-position:center; }
    </style>
    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <h1 class="hero-title">Bienvenue chez EcoNutri</h1>
            <p class="hero-subtitle">D√©couvrez nos produits bio frais et locaux pour une alimentation saine</p>
            <a href="#categories" class="btn btn-primary-custom">
                Shop Now <i class="fas fa-arrow-right ms-2"></i>
            </a>
        </div>
    </section>

    <!-- Categories Section -->
    <section id="categories" class="categories-section">
        <div class="container">
            <h2 class="section-title">Nos Cat√©gories</h2>
            <p class="section-subtitle">Explorez notre s√©lection de produits bio par cat√©gorie</p>

            {% set cats = get_categories()|default([]) %}
            
            <!-- Layout Grille Moderne -->
            <div class="categories-grid">
                {% for cat in cats %}
                    <div class="category-item">
                        <a href="{{ path('app_category', {id: cat.id}) }}" class="category-card-modern">
                            <div class="category-image-wrapper">
                                <div class="category-image" style="background-image: url('{{ asset('images/' ~ (cat.image ?: 'category-default.jpg')) }}');"></div>
                                <div class="category-overlay"></div>
                                <div class="category-icon">
                                    <i class="fas fa-leaf"></i>
                                </div>
                            </div>
                            <div class="category-content">
                                <h3 class="category-name">{{ cat.name }}</h3>
                                <span class="category-link">D√©couvrir <i class="fas fa-arrow-right"></i></span>
                            </div>
                        </a>
                    </div>
                {% else %}
                    <div class="col-12 text-center">
                        <p class="text-muted">Aucune cat√©gorie disponible pour le moment.</p>
                    </div>
                {% endfor %}
            </div>

            <!-- Alternative: Layout avec cartes horizontales pour mobile -->
            <div class="categories-horizontal-scroll d-lg-none">
                <div class="horizontal-scroll-container">
                    {% for cat in cats %}
                        <a href="{{ path('app_category', {id: cat.id}) }}" class="category-card-horizontal">
                            <div class="category-horizontal-image" style="background-image: url('{{ asset('images/' ~ (cat.image ?: 'category-default.jpg')) }}');"></div>
                            <span class="category-horizontal-name">{{ cat.name }}</span>
                        </a>
                    {% endfor %}
                </div>
            </div>

        </div>
    </section>

    <!-- Produits Recommand√©s Section -->
    <section id="recommandes" class="products-section">
        <div class="container">
            <h2 class="section-title" data-original-title="Produits Recommand√©s">Produits Recommand√©s</h2>
            <p class="section-subtitle">D√©couvrez nos meilleurs produits tunisiens s√©lectionn√©s pour vous</p>
            
            <div class="row g-4">
                {% for product in recommendedProducts %}
                <div class="col-md-4">
                    <div class="product-card">
                        <div class="product-image">
                            <img src="{{ asset('images/' ~ product.image) }}" alt="{{ product.name }}" class="product-card-img">
                        </div>
                        <h3 class="product-name">{{ product.name }}</h3>
                        <div class="product-meta">
                            <span class="product-origin">{{ product.origin ?? 'Local' }}</span>
                                    <span class="stock-badge">{{ (product.stock|default(0)) > 0 ? 'En stock' : 'Rupture' }}</span>
                        </div>
                        <p class="product-description">{{ product.description }}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="product-price">{{ product.price }} TND</span>
                        </div>
                        <div class="mt-3">
                            <a href="{{ path('app_product', {id: product.id}) }}" class="btn btn-add-cart me-2">
                                <i class="fas fa-eye me-2"></i>Voir le produit
                            </a>
                            
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="col-12">
                    <p class="text-center text-muted">Aucun produit recommand√© disponible pour le moment.</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- Nouveaut√©s Section -->
    <section id="nouveautes" class="products-section bg-light">
        <div class="container">
            <h2 class="section-title">Nouveaut√©s</h2>
            <p class="section-subtitle">D√©couvrez nos derni√®res arrivages de produits frais</p>
            
            <div class="row g-4">
                {% for product in newProducts %}
                <div class="col-md-4">
                    <div class="product-card">
                        <div class="product-badge">Nouveau</div>
                        <div class="product-image">
                            <img src="{{ asset('images/' ~ product.image) }}" alt="{{ product.name }}" class="product-card-img">
                        </div>
                        <h3 class="product-name">{{ product.name }}</h3>
                        <div class="product-meta">
                            <span class="product-origin">{{ product.origin ?? 'Local' }}</span>
                            <span class="stock-badge">{{ (product.stock|default(0)) > 0 ? 'En stock' : 'Rupture' }}</span>
                        </div>
                        <p class="product-description">{{ product.description }}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="product-price">{{ product.price }} TND</span>
                        </div>
                        <div class="mt-3">
                            <a href="{{ path('app_product', {id: product.id}) }}" class="btn btn-add-cart me-2">
                                <i class="fas fa-eye me-2"></i>Voir le produit
                            </a>
                           
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="col-12">
                    <p class="text-center text-muted">Aucun nouveau produit disponible pour le moment.</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <!-- Conseils Section avec Formulaire -->
    <section id="conseils" class="conseils-section">
        <div class="container">
            <h2 class="section-title">Conseils Nutritionnels</h2>
            <p class="section-subtitle">Analysez votre sant√© avec notre outil de pr√©diction du diab√®te</p>
            
            <div class="conseils-container">
                <div class="conseils-info">
                    <h3>Votre Sant√© Nous Importe</h3>
                    <p>Remplissez ce formulaire avec les donn√©es de votre dernier bilan de sant√© pour obtenir une √©valuation pr√©liminaire de votre risque de diab√®te.</p>
                    
                    <div class="health-tips">
                        <div class="tip-card">
                            <i class="fas fa-heartbeat"></i>
                            <h4>Important</h4>
                            <p>Ces r√©sultats sont indicatifs et ne remplacent pas une consultation m√©dicale professionnelle.</p>
                        </div>
                        <div class="tip-card">
                            <i class="fas fa-notes-medical"></i>
                            <h4>Pr√©cision</h4>
                            <p>Utilisez les donn√©es exactes de vos derni√®res analyses m√©dicales pour des r√©sultats plus fiables.</p>
                        </div>
                    </div>
                </div>

                <div class="conseils-form-container">
                    <form id="diabetes-form" class="diabetes-form">
                        <div class="form-header">
                            <i class="fas fa-stethoscope"></i>
                            <h3>√âvaluation Diab√®te</h3>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="pregnancies">Grossesses</label>
                                <input type="number" id="pregnancies" name="pregnancies" min="0" max="20" required>
                                <small>Nombre de grossesses (0 si homme)</small>
                            </div>

                            <div class="form-group">
                                <label for="glucose">Glucose</label>
                                <input type="number" id="glucose" name="glucose" min="0" max="200" required>
                                <small>Concentration en glucose (mg/dL)</small>
                            </div>

                            <div class="form-group">
                                <label for="blood_pressure">Pression Art√©rielle</label>
                                <input type="number" id="blood_pressure" name="blood_pressure" min="0" max="122" required>
                                <small>Pression art√©rielle (mm Hg)</small>
                            </div>

                            <div class="form-group">
                                <label for="skin_thickness">√âpaisseur Peau</label>
                                <input type="number" id="skin_thickness" name="skin_thickness" min="0" max="99" required>
                                <small>√âpaisseur du pli cutan√© (mm)</small>
                            </div>

                            <div class="form-group">
                                <label for="insulin">Insuline</label>
                                <input type="number" id="insulin" name="insulin" min="0" max="846" required>
                                <small>Insuline (mu U/ml)</small>
                            </div>

                            <div class="form-group">
                                <label for="bmi">IMC</label>
                                <input type="number" step="0.1" id="bmi" name="bmi" min="0" max="67.1" required>
                                <small>Indice de Masse Corporelle</small>
                            </div>

                            <div class="form-group">
                                <label for="diabetes_pedigree">Ant√©c√©dents Familiaux</label>
                                <input type="number" step="0.001" id="diabetes_pedigree" name="diabetes_pedigree" min="0" max="2.42" required>
                                <small>Fonction de pedigree diab√®te</small>
                            </div>

                            <div class="form-group">
                                <label for="age">√Çge</label>
                                <input type="number" id="age" name="age" min="1" max="120" required>
                                <small>√Çge en ann√©es</small>
                            </div>
                        </div>

                        <button type="submit" class="btn-analyze">
                            <i class="fas fa-chart-line"></i>
                            Analyser les R√©sultats
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="about-section">
        <div class="container">
            <h2 class="section-title">√Ä Propos d'EcoNutri</h2>
            
            <div class="row align-items-center mb-5">
                <div class="col-lg-6">
                    <h3 class="mb-4">Notre Histoire</h3>
                    <p class="lead">
                        EcoNutri est n√© d'une passion pour une alimentation saine et respectueuse de l'environnement. 
                        Fond√© en 2025, notre objectif est de rendre les produits biologiques accessibles √† tous.
                    </p>
                    <p>
                        Nous collaborons directement avec des producteurs locaux pour vous offrir des produits frais, 
                        de saison et cultiv√©s dans le respect de la nature.
                    </p>
                </div>
                <div class="col-lg-6">
                    <!-- Deux photos c√¥te √† c√¥te -->
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="team-member">
                                <img src="{{ asset('images/wejden.jpg') }}" alt="Wejden Ferjeni" class="img-fluid rounded-circle shadow mb-3 team-photo">
                                <h5 class="fw-bold">Wejden Ferjeni</h5>
                                <p class="text-muted">Co-fondatrice</p>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="team-member">
                                <img src="{{ asset('images/mariem.jpg') }}" alt="Mariem Laabidi" class="img-fluid rounded-circle shadow mb-3 team-photo">
                                <h5 class="fw-bold">Mariem Laabidi</h5>
                                <p class="text-muted">Co-fondatrice</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mission & Vision -->
            <div class="row mt-5">
                <div class="col-md-4 mb-4">
                    <div class="about-card p-4 text-center h-100">
                        <i class="fas fa-bullseye fa-3x text-success mb-3"></i>
                        <h4>Notre Mission</h4>
                        <p class="mb-0">Promouvoir une alimentation saine et durable en proposant des produits bio de qualit√©.</p>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="about-card p-4 text-center h-100">
                        <i class="fas fa-eye fa-3x text-success mb-3"></i>
                        <h4>Notre Vision</h4>
                        <p class="mb-0">Devenir la r√©f√©rence en mati√®re d'alimentation biologique et de conseils nutritionnels.</p>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="about-card p-4 text-center h-100">
                        <i class="fas fa-heart fa-3x text-success mb-3"></i>
                        <h4>Nos Valeurs</h4>
                        <p class="mb-0">Transparence, qualit√©, respect de l'environnement et engagement client.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Chatbot n8n -->
    <link href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" rel="stylesheet" />
    <style>
        /* Ajustements visuels pour matcher le th√®me vert du site */
        .n8n-chat-launcher {
            background: linear-gradient(135deg, #2f9e44, #28a745);
            box-shadow: 0 10px 30px rgba(47, 158, 68, 0.35);
            border: none;
        }
        .n8n-chat-launcher:hover {
            transform: translateY(-1px);
            box-shadow: 0 14px 34px rgba(47, 158, 68, 0.4);
        }
        .n8n-chat-window {
            border-radius: 16px;
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.18);
        }
        .n8n-chat-header {
            background: linear-gradient(135deg, #2f9e44, #28a745);
            color: #fff;
        }
        .n8n-chat-message-user {
            background: #2f9e44;
            color: #fff;
            border-radius: 14px;
        }
        .n8n-chat-message-assistant {
            background: #f6fff8;
            color: #0b3d2e;
            border-radius: 14px;
        }
        .n8n-chat-input textarea,
        .n8n-chat-input input {
            border-color: #2f9e44;
        }
        .n8n-chat-send-button {
            background: #2f9e44;
            border-color: #2f9e44;
        }
        .n8n-chat-send-button:hover {
            background: #27863a;
            border-color: #27863a;
        }
    </style>
    <script type="module">
        import { createChat } from 'https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js';

        createChat({
            webhookUrl: 'https://wejden.app.n8n.cloud/webhook/9e84c09f-106e-4c18-9913-07b1e163af28/chat',
            mode: 'window',
            loadPreviousSession: true,
            showWelcomeScreen: true,
            defaultLanguage: 'fr',
            chatInputKey: 'chatInput',
            chatSessionKey: 'sessionId',
            metadata: {},
            initialMessages: [
                'Bonjour! üëã Je suis √âconotrie, votre assistant nutrition. Comment puis-je vous aider aujourd\'hui?'
            ],
            i18n: {
                fr: {
                    title: 'üí¨ Assistant √âconotrie',
                    subtitle: 'Powered by Google Gemini',
                    footer: '',
                    getStarted: 'Commencer',
                    inputPlaceholder: 'Posez votre question sur la nutrition...',
                }
            },
            theme: {}
        });
    </script>
{% endblock %}