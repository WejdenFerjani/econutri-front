{% extends 'base.html.twig' %}

{% block title %}Panier - EcoNutri{% endblock %}

{% block body %}
<!-- Hero Section for Cart -->
<section class="cart-hero" style="background-image: url('{{ asset('images/healthy-food.jpeg') }}');">
    <div class="container">
        <h1 class="cart-hero-title">MON PANIER</h1>
    </div>
</section>
<div class="container mt-5 pt-5">

    {% if cartItems is empty %}
        <div class="empty-cart-wrapper text-center py-5">
            <div class="empty-cart-card mx-auto p-4">
                <div class="empty-cart-icon mb-3">
                    <i class="fas fa-shopping-cart fa-4x"></i>
                </div>
                <h3 class="mb-2">Votre panier est vide</h3>
                <p class="text-muted">Ajoutez des produits délicieux à votre panier pour commencer une commande.</p>
                <a href="{{ path('app_home') }}" class="btn btn-primary btn-cta mt-3">Retour aux produits</a>
            </div>
        </div>
    {% else %}
        <div class="table-responsive">
            <table class="table cart-table">
                <thead class="table-header-cart">
                    <tr>
                        <th>Produit</th>
                        <th>Nom</th>
                        <th>Prix</th>
                        <th>Quantité</th>
                        <th>Total</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in cartItems %}
                    <tr>
                        <td>
                            <img src="{{ asset('images/' ~ item.product.image) }}" alt="{{ item.product.name }}" class="cart-product-img">
                        </td>
                        <td>{{ item.product.name }}</td>
                        <td>{{ item.product.price }} TND</td>
                        <td>
    <form method="POST" action="{{ path('app_cart_update', {'id': item.product.id}) }}" class="d-inline auto-update-form">
        <input type="number" name="quantity" value="{{ item.quantity }}" min="1" max="{{ item.product.stock|default(1) }}" 
               class="form-control quantity-input auto-update" style="width: 80px;">
    </form>
</td>
                        <td>{{ (item.product.price * item.quantity)|number_format(2, '.', ',') }} TND</td>
                        <td>
                            <form method="POST" action="{{ path('app_cart_remove', {'id': item.product.id}) }}" class="d-inline">
                                <button type="submit" class="btn btn-sm btn-danger">Supprimer</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

      <div class="row mt-5 justify-content-center">
    <div class="col-md-4 col-lg-3">
        <a href="{{ path('app_home') }}" class="btn btn-warning btn-md w-100 mb-3">Voir Produits Recommandés</a>
    </div>
    <div class="col-md-4 col-lg-3">
        <form method="POST" action="{{ path('app_cart_clear') }}" class="mb-3">
            <button type="submit" class="btn btn-secondary btn-md w-100">Vider le Panier</button>
        </form>
    </div>
</div>

<!-- Cart Summary - Centered -->
<div class="row justify-content-center mt-5">
    <div class="col-md-8 col-lg-6">
        <div class="card cart-summary">
            <div class="card-body">
                <h5 class="card-title text-center">Récapitulatif</h5>
                <div class="d-flex justify-content-between mb-2">
                    <span>Sous-total:</span>
                    <span>{{ cartTotal }} TND</span> 
                </div>
                <div class="d-flex justify-content-between mb-3 border-bottom pb-2">
                    <span>Frais de livraison:</span>
                    <span>{{ shippingCost }} TND</span>
                </div>
                <div class="d-flex justify-content-between mb-4 fw-bold">
                    <span>Total:</span>
                    <span>{{ totalWithShipping }} TND</span> 
                </div>
                <a href="{{ path('app_order_checkout') }}" class="btn btn-success btn-lg w-100">Procéder à la Commande</a>
            </div>
        </div>
    </div>
</div>



        
    {% endif %}
</div>

<style>
/* Cart Hero Section */
.cart-hero {
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    height: 400px; /* Bigger photo */
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    margin-bottom: 3rem; /* Space below hero */
}

.cart-hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
}

.cart-hero-title {
    color: white;
    font-size: 3.5rem; /* Slightly bigger title */
    font-weight: bold;
    position: relative;
    z-index: 1;
    text-align: center;
}

/* Add more spacing between table rows */
.cart-table tbody tr {
    margin-bottom: 1rem;
}

.cart-table td {
    padding: 1.5rem 1rem; /* More padding in cells */
}

/* Space between sections */
.section-spacing {
    margin: 3rem 0;
}

/* Cart Table Styles */
.cart-table {
    background: white;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    margin-top: 2rem;
}

/* Empty cart styles */
.empty-cart-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
}
.empty-cart-card {
    max-width: 540px;
    background: linear-gradient(135deg, #ffffff, #f8fff8);
    border: 1px solid #e6f4e6;
    border-radius: 16px;
    box-shadow: 0 20px 50px rgba(16,24,40,0.08);
}
.empty-cart-icon {
    width: 96px;
    height: 96px;
    border-radius: 50%;
    background: linear-gradient(135deg, rgba(46,125,50,0.12), rgba(139,195,74,0.06));
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
}
.empty-cart-icon i {
    color: var(--primary-color);
}
.btn-cta {
    background: linear-gradient(135deg, #4caf50, #2e7d32);
    border: none;
    color: #fff;
    padding: 12px 28px;
    border-radius: 10px;
    font-weight: 700;
}
.btn-cta:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(46,125,50,0.2); }

.table-header-cart {
    background: linear-gradient(135deg, #6ba75c, #4a8c3a);
    color: white;
    font-weight: bold;
    font-size: 1.1rem;
}

.table-header-cart th {
    border: none;
    padding: 20px 15px;
    text-align: center;
}

.cart-product-img {
    width: 100px;
    height: 100px;
    object-fit: cover;
    border-radius: 10px;
    border: 2px solid #e9ecef;
}

.quantity-input {
    border: 2px solid #6ba75c;
    border-radius: 8px;
    padding: 8px;
    text-align: center;
    width: 90px;
}

.quantity-input:focus {
    border-color: #4a8c3a;
    box-shadow: 0 0 5px rgba(107, 167, 92, 0.5);
}

/* Cart Summary Card */
.cart-summary {
    border: 2px solid #6ba75c;
    border-radius: 15px;
    background: linear-gradient(135deg, #f8fff8, #e8f5e8);
    box-shadow: 0 4px 15px rgba(107, 167, 92, 0.2);
}

.cart-summary .card-body {
    padding: 2rem;
}

.cart-summary .card-title {
    color: #6ba75c;
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 1.5rem;
    text-align: center;
}

/* Buttons */
.btn-success {
    background: linear-gradient(135deg, #6ba75c, #5a9048);
    border: none;
    border-radius: 10px;
    padding: 12px 30px;
    font-weight: bold;
    transition: all 0.3s ease;
}

.btn-success:hover {
    background: linear-gradient(135deg, #5a9048, #4a7c3a);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(90, 144, 72, 0.4);
}

.btn-warning {
    background: linear-gradient(135deg, #ffc107, #e0a800);
    border: none;
    border-radius: 10px;
    padding: 12px 30px;
    font-weight: bold;
    transition: all 0.3s ease;
}

.btn-warning:hover {
    background: linear-gradient(135deg, #e0a800, #c69500);
    transform: translateY(-2px);
}

.btn-secondary {
    background: linear-gradient(135deg, #6c757d, #5a6268);
    border: none;
    border-radius: 10px;
    padding: 12px 30px;
    font-weight: bold;
    transition: all 0.3s ease;
}

.btn-secondary:hover {
    background: linear-gradient(135deg, #5a6268, #495057);
    transform: translateY(-2px);
}

/* Table cells alignment */
.cart-table td {
    vertical-align: middle;
    text-align: center;
    padding: 15px;
    border-bottom: 1px solid #e9ecef;
}

.cart-table tr:last-child td {
    border-bottom: none;
}

/* Responsive design */
@media (max-width: 768px) {
    .cart-hero {
        height: 200px;
    }
    
    .cart-hero-title {
        font-size: 2rem;
    }
    
    .cart-product-img {
        width: 70px;
        height: 70px;
    }
}
</style>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-update quantity when changed
    document.querySelectorAll('.auto-update').forEach(input => {
        input.addEventListener('change', function() {
            this.closest('form').submit();
        });
    });
});
</script>
{% endblock %}
